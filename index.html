<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulaire - Nuit des Tresses Africaines 3</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <img src="logo/logo.png" alt="Logo RAF MIXTE COIFFURE" class="logo" />
      <h1>Formulaire de Participation – Coiffeuses et coiffeurs</h1>
      <p class="subtitle">
        Dans le cadre de <strong>La Nuit des Tresses Africaines 3</strong> (22 nov. 2025 à Parakou), RAF MIXTE COIFFURE invite des Coiffeuses et coiffeurs talentueux à rejoindre cet événement dédié à la beauté capillaire africaine.
      </p>
      <p class="subtitle">
        Ce formulaire recueille les infos nécessaires à la sélection : <strong>expérience</strong>, <strong>spécialités</strong> et <strong>motivation</strong>.
      </p>
      <p class="subtitle">
        La sélection se fera selon le <strong>professionnalisme</strong>, la <strong>créativité</strong>, la <strong>disponibilité</strong> et l’<strong>engagement</strong>.
      </p>
    </header>

    <form id="formulaire" method="POST" 
          action="https://script.google.com/macros/s/AKfycbygpkwnd2bS2_t0VVys6HGtVhJER4SEGl6lpvrwA72tWRIx92ZJ6o--3wFnYGUWHaGa/exec" 
          enctype="multipart/form-data" 
          novalidate
    >

      <h2>Informations personnelles</h2>

      <label for="nom">Nom complet :</label>
      <input type="text" id="nom" name="nom" required />

      <label for="salon">Nom du salon :</label>
      <input type="text" id="salon" name="salon" />

      <label for="telephone">Téléphone WhatsApp :</label>
      <input type="tel" id="telephone" name="telephone" required pattern="[\d\s+\-]{6,}" />

      <label for="email">Email :</label>
      <input type="email" id="email" name="email" required />

      <label for="ville">Ville / Quartier :</label>
      <input type="text" id="ville" name="ville" required />

      <h2>Informations professionnelles</h2>

      <label for="experience">Expérience en coiffure (en années) :</label>
      <input type="number" id="experience" name="experience" min="0" />

      <label for="specialites">Spécialités :</label>
      <input type="text" id="specialites" name="specialites" />

      <label for="evenement">Avez-vous déjà participé à un événement ?</label>
      <select id="evenement" name="evenement" required>
        <option value="" disabled selected>Choisissez</option>
        <option value="Oui">Oui</option>
        <option value="Non">Non</option>
      </select>

      <label for="details_evenement">Si oui, précisez :</label>
      <input type="text" id="details_evenement" name="details_evenement" />

      <h2>Portfolio</h2>

      <label for="portfolio">Lien vers vos pages (Facebook, Instagram...) :</label>
      <input type="url" id="portfolio" name="portfolio" />

      <label for="photos">Upload de photos de vos réalisations :</label>
      <input type="file" id="photos" name="photos" accept=".jpg,.jpeg,.png" multiple />

      <h2>Engagement</h2>

      <label><input type="checkbox" name="dispo" required /> Je suis disponible le 22 novembre 2025</label>
      <label><input type="checkbox" name="conditions" required /> J’accepte les conditions de participation</label>

      <p style="margin-top: 1rem; font-weight: bold;">Engagements professionnels :</p>

      <label><input type="checkbox" name="engagements" value="Respect des horaires" /> Je m’engage à respecter les horaires de l’événement</label>
      <label><input type="checkbox" name="engagements" value="Professionnalisme sur scène" /> Je m’engage à adopter une attitude professionnelle sur scène</label>
      <label><input type="checkbox" name="engagements" value="Tenue correcte exigée" /> Je respecterai le dress code ou la tenue exigée</label>
      <label><input type="checkbox" name="engagements" value="Disponibilité pour les répétitions" /> Je serai disponible pour les répétitions si besoin</label>
      <label><input type="checkbox" name="engagements" value="Participation active" /> Je participerai activement à la réussite de l’événement</label>
      <label><input type="checkbox" name="engagements" value="Respect du règlement" /> Je respecterai le règlement intérieur de l’événement</label>

      <label for="motivation">Motivation personnelle :</label>
      <textarea id="motivation" name="motivation" rows="4" placeholder="Pourquoi souhaitez-vous participer ? (150 mots max)" required></textarea>

      <label><input type="checkbox" name="confirmation" required /> Je confirme l’exactitude des informations fournies</label>

      <button type="submit">Envoyer ma candidature</button>
    </form>
  </div>

  <script>
    (function () {
      const form = document.getElementById("formulaire");
      const photoInput = document.getElementById("photos");
      const motivationTextarea = document.getElementById("motivation");

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        const files = photoInput.files;
        const validTypes = ["image/jpeg", "image/png"];

        for (const file of files) {
          if (!validTypes.includes(file.type)) {
            alert("❌ Seuls les formats JPG ou PNG sont acceptés.");
            return;
          }
          if (file.size > 5 * 1024 * 1024) {
            alert("❌ Chaque photo doit faire moins de 5 Mo.");
            return;
          }
        }

        const motivationText = motivationTextarea.value.trim();
        const wordCount = motivationText.split(/\s+/).filter(Boolean).length;

        if (wordCount > 150) {
          alert(`❌ Votre texte de motivation contient ${wordCount} mots. La limite est de 150.`);
          return;
        }

        const data = new FormData(form);

        try {
          // Envoi vers Google Sheets
          const googleResponse = await fetch(form.action, {
            method: "POST",
            body: data,
          });

          if (!googleResponse.ok) {
            console.warn("⚠️ Envoi vers Google Sheets a échoué.");
          }

          // Envoi vers backend Express en ligne (correction ici)
          const backendResponse = await fetch("https://backend-nuit-tresses.onrender.com/api/candidature", {
            method: "POST",
            body: data,
          });

          if (backendResponse.ok) {
            alert("✅ Merci ! Votre candidature a bien été envoyée.");
            window.location.href = "merci.html";
          } else {
            alert("❌ Une erreur est survenue côté serveur.");
          }
        } catch (error) {
          alert("❌ Une erreur est survenue. Veuillez vérifier votre connexion.");
          console.error("Erreur côté client :", error);
        }
      });
    })();
  </script>
</body>
</html>
