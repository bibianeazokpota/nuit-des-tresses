<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulaire - Nuit des Tresses Africaines 3</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <img src="logo/logo.png" alt="Logo RAF MIXTE COIFFURE" class="logo" />
      <h1>Formulaire de Participation – Coiffeuses et coiffeurs</h1>
      <p class="subtitle">
        Dans le cadre de <strong>La Nuit des Tresses Africaines 3</strong> (22 nov. 2025 à Parakou), RAF MIXTE COIFFURE invite des Coiffeuses et coiffeurs talentueux à rejoindre cet événement dédié à la beauté capillaire africaine.
      </p>
      <p class="subtitle">
        Ce formulaire recueille les infos nécessaires à la sélection : <strong>expérience</strong>, <strong>spécialités</strong> et <strong>motivation</strong>.
      </p>
      <p class="subtitle">
        La sélection se fera selon le <strong>professionnalisme</strong>, la <strong>créativité</strong>, la <strong>disponibilité</strong> et l’<strong>engagement</strong>.
      </p>
    </header>

<form id="formulaire" method="POST"
  action="https://script.google.com/macros/s/AKfycbzdlMRtQ8AT-tUH-YKuwa0Q41c_p-jJW8ESWL3MGS-MNg9S9f0Kp7Qk3f034dsA6Th6/exec"
  enctype="multipart/form-data" novalidate>

  <input type="hidden" name="timestamp" id="timestamp" />

  <!-- Autres sections inchangées jusqu'ici -->

  <label for="portfolio">Lien vers vos pages (Facebook, Instagram...) :</label>
  <input type="url" id="portfolio" name="portfolio" autocomplete="url" />

  <label for="photos">Upload de photos de vos réalisations :</label>
  <input type="file" id="photos" name="photos" accept=".jpg,.jpeg,.png" multiple />

  <!-- Ajout d'id pour les cases à cocher -->
  <h2>Engagement</h2>
  <div class="checkbox-group">
    <input type="checkbox" id="dispo" name="dispo" required />
    <label for="dispo">Je suis disponible le 22 novembre 2025</label><br/>

    <input type="checkbox" id="conditions" name="conditions" required />
    <label for="conditions">J’accepte les conditions de participation</label>
  </div>

  <p style="margin-top: 1rem; font-weight: bold;">Engagements professionnels :</p>
  <div class="checkbox-group">
    <input type="checkbox" id="horaire" name="engagements" value="Respect des horaires" />
    <label for="horaire">Respect des horaires</label><br/>
    
    <input type="checkbox" id="scene" name="engagements" value="Professionnalisme sur scène" />
    <label for="scene">Professionnalisme sur scène</label><br/>
    
    <input type="checkbox" id="tenue" name="engagements" value="Tenue correcte exigée" />
    <label for="tenue">Tenue correcte exigée</label><br/>
    
    <input type="checkbox" id="repetition" name="engagements" value="Disponibilité pour les répétitions" />
    <label for="repetition">Disponibilité pour les répétitions</label><br/>
    
    <input type="checkbox" id="active" name="engagements" value="Participation active" />
    <label for="active">Participation active</label><br/>
    
    <input type="checkbox" id="reglement" name="engagements" value="Respect du règlement" />
    <label for="reglement">Respect du règlement</label>
  </div>

  <label for="motivation">Motivation personnelle :</label>
  <textarea id="motivation" name="motivation" rows="4" autocomplete="off" placeholder="Pourquoi souhaitez-vous participer ? (150 mots max)" required></textarea>

  <input type="checkbox" id="confirmation" name="confirmation" required />
  <label for="confirmation">Je confirme l’exactitude des informations fournies</label>

  <button type="submit">Envoyer ma candidature</button>
</form>

    
  </div>

  <script>
    (function () {
      const form = document.getElementById("formulaire");
      const photoInput = document.getElementById("photos");
      const motivationTextarea = document.getElementById("motivation");
      const timestampInput = document.getElementById("timestamp");

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        // Validation des images
        const files = photoInput.files;
        const validTypes = ["image/jpeg", "image/png"];

        for (const file of files) {
          if (!validTypes.includes(file.type)) {
            return alert("❌ Seuls les formats JPG ou PNG sont acceptés.");
          }
          if (file.size > 5 * 1024 * 1024) {
            return alert("❌ Chaque photo doit faire moins de 5 Mo.");
          }
        }

        // Vérification du nombre de mots de motivation
        const motivationText = motivationTextarea.value.trim();
        const wordCount = motivationText.split(/\s+/).filter(Boolean).length;
        if (wordCount > 150) {
          return alert(`❌ Votre texte contient ${wordCount} mots. Limite : 150.`);
        }

        // Ajout du timestamp
        timestampInput.value = new Date().toISOString();

        // Traitement des engagements
        const engagements = Array.from(document.querySelectorAll("input[name='engagements']:checked"))
          .map(input => input.value);
        
        // Envoi des données
        const formData = new FormData(form);
        formData.set("engagements", engagements.join(", "));

        try {
          // Google Apps Script (Google Sheet)
          const responseGoogle = await fetch(form.action, {
            method: "POST",
            body: formData
          });

          if (!responseGoogle.ok) {
            console.warn("⚠️ Envoi vers Google Sheets échoué.");
          }

          // Backend Node.js (Render)
          const responseBackend = await fetch("https://backend-nuit-tresses.onrender.com/api/candidature", {
            method: "POST",
            body: formData
          });

          if (responseBackend.ok) {
            alert("✅ Merci ! Votre candidature a bien été envoyée.");
            window.location.href = "merci.html";
          } else {
            alert("❌ Une erreur serveur est survenue. Veuillez réessayer.");
          }
        } catch (error) {
          console.error("Erreur d'envoi :", error);
          alert("❌ Une erreur réseau est survenue. Vérifiez votre connexion.");
        }
      });
    })();
  </script>
</body>
</html>
